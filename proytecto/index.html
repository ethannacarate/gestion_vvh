<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Gestión de Instrumental - Liceo</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="static/css/styles.css" />
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Sistema Liceo</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Inicio</a>
                    </li>
                    <li id="nav-agregar-db" class="nav-item">
                        <a class="nav-link" href="/admin/agregar-nuevo">
                            <i class="fa-solid fa-square-plus"></i> Agregar a DB
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Vista de Login -->
    <div id="login-view" class="view-login">
        <div class="login-box">
            <h1>Bienvenido al Sistema</h1>
            <h2>Iniciar Sesión</h2>

            <div class="input-group">
                <label for="login-email">Correo Electrónico:</label>
                <input type="email" id="login-email" placeholder="Ingrese su correo institucional" required />
            </div>

            <div class="input-group">
                <label for="login-password">Contraseña:</label>
                <input type="password" id="login-password" placeholder="••••••••" required />
            </div>

            <p id="login-error-message" class="error-message hidden">Credenciales incorrectas. Inténtelo nuevamente.</p>

            <button type="button" onclick="handleLogin()">Acceder</button>
        </div>
    </div>

    <!-- Vista Principal -->
    <div id="main-app-view" class="view-app hidden">
        <header>
            <div class="header-content">
                <h1>Gestión de Instrumental | Rol: <span id="current-role-display"></span></h1>
                <button id="logout-button" type="button" onclick="logout()">Cerrar Sesión</button>
            </div>
        </header>

        <main class="container mt-4">
            <!-- Sección: Agregar Nueva Persona -->
            <section id="add-person-section" class="card hidden">
                <h2><i class="fas fa-user-plus"></i> Registrar Nueva Persona</h2>
                <div class="input-group">
                    <label for="newPersonaCodigo">Identificador Escaneado:</label>
                    <input type="text" id="newPersonaCodigo" readonly />
                </div>
                <div class="input-group">
                    <label for="newPersonaNombre">Nombre Completo:</label>
                    <input type="text" id="newPersonaNombre" placeholder="Ej: Ana M. Pérez R." />
                </div>
                <div class="input-group">
                    <label for="newPersonaRol">Rol:</label>
                    <select id="newPersonaRol">
                        <option value="estudiante">Estudiante</option>
                        <option value="docente">Docente</option>
                        <option value="directivo">Directivo</option>
                        <option value="director">Director</option>
                    </select>
                </div>
                <button type="button" onclick="registrarNuevaPersona()">Guardar Persona</button>
            </section>

            <!-- Sección: Préstamo / Devolución -->
            <section id="loan-return-section" class="card">
                <h2><i class="fas fa-exchange-alt"></i> Préstamo / Devolución</h2>

                <div class="input-group">
                    <label for="codigoInstrumento">1. Código de Instrumento:</label>
                    <input
                        type="text"
                        id="codigoInstrumento"
                        placeholder="Escanear Instrumento..."
                        autofocus
                        onchange="handleInstrumentScan(this.value)"
                    />
                </div>

                <div class="data-preview data-instrument">
                    <h3>Instrumento: <span id="nombreInstrumento">---</span></h3>
                    <p>Estado Actual: <span id="estadoInstrumento">---</span> <span id="estadoIcon"></span></p>
                </div>

                <div id="loan-form" class="hidden">
                    <div class="input-group">
                        <label for="codigoPersona">2. Pasaporte Escolar / Cédula:</label>
                        <input
                            type="text"
                            id="codigoPersona"
                            placeholder="Escanear Pasaporte o Cédula..."
                            onchange="handlePersonScan(this.value)"
                        />
                    </div>

                    <div class="data-preview data-person">
                        <h3>Persona: <span id="nombrePersona">---</span></h3>
                        <p>Rol: <span id="rolPersona">---</span></p>
                    </div>

                    <div class="control-group">
                        <div class="input-group quantity-control">
                            <label for="cantidad">Cantidad:</label>
                            <input type="number" id="cantidad" value="1" min="1" />
                        </div>

                        <!-- Autorización por docente -->
                        <div class="input-group checkbox-group">
                            <input type="checkbox" id="autorizadoDocente" onchange="toggleDocenteField()" />
                            <label for="autorizadoDocente">Autorizado por Docente</label>
                        </div>

                        <div id="docente-field" class="input-group hidden">
                            <label for="nombreDocente">Nombre del Docente Autorizante:</label>
                            <input type="text" id="nombreDocente" placeholder="Ej: Prof. María González" />
                        </div>

                        <!-- Préstamo largo plazo (solo director) -->
                        <div class="input-group checkbox-group">
                            <input type="checkbox" id="prestamoLargoPlazo" onchange="toggleLargoPlazoField()" />
                            <label for="prestamoLargoPlazo">Préstamo Largo Plazo</label>
                        </div>

                        <div id="largo-plazo-field" class="input-group hidden">
                            <label for="duracionPrestamo">Duración del Préstamo (días):</label>
                            <input type="number" id="duracionPrestamo" value="7" min="1" placeholder="Ej: 14" />
                        </div>
                    </div>

                    <button id="registrarBtn" type="button" onclick="registrarPrestamo()">Registrar Préstamo</button>
                </div>

                <div id="return-button-container" class="hidden">
                    <p class="status-return">
                        Instrumento <strong>OCUPADO</strong> por <span id="loaned-by"></span>.
                    </p>
                    <button type="button" onclick="confirmarDevolucion()">Confirmar Devolución</button>
                </div>
            </section>

            <!-- Área de estado -->
            <section class="status-area">
                <h2><i class="fas fa-info-circle"></i> Estado de la Operación</h2>
                <p id="statusMessage">Esperando operación...</p>
            </section>

            <!-- Préstamos Activos -->
            <section id="active-loans-section" class="card mt-4">
                <div class="section-header">
                    <h2><i class="fas fa-clock"></i> Préstamos Activos</h2>
                    <div class="filters">
                        <input type="text" id="filter-active-name" placeholder="Filtrar por nombre..." oninput="filterTable('active')" />
                        <input type="date" id="filter-active-date" oninput="filterTable('active')" />
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Instrumento</th>
                                <th>Estado</th>
                                <th>Persona</th>
                                <th>Cantidad</th>
                                <th>Autorizado por</th>
                                <th>Duración (días)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="active-loans-body"></tbody>
                    </table>
                </div>
            </section>

            <!-- Historial de Devoluciones -->
            <section id="returned-history-section" class="card mt-4">
                <div class="section-header">
                    <h2><i class="fas fa-check-circle"></i> Historial de Devoluciones</h2>
                    <div class="filters">
                        <input type="text" id="filter-returned-name" placeholder="Filtrar por nombre..." oninput="filterTable('returned')" />
                        <input type="date" id="filter-returned-date" oninput="filterTable('returned')" />
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Fecha Devolución</th>
                                <th>Instrumento</th>
                                <th>Estado</th>
                                <th>Persona</th>
                                <th>Cantidad</th>
                                <th>Autorizado por</th>
                                <th>Duración (días)</th>
                            </tr>
                        </thead>
                        <tbody id="returned-history-body"></tbody>
                    </table>
                </div>
            </section>
        </main>

        <footer class="mt-5 py-3 text-center">
            <p>&copy; 2025 Proyecto Liceo | Sistema de Gestión de Instrumental</p>
        </footer>
    </div>

    <!-- Modal: Agregar Nuevo Instrumento -->
    <div class="modal fade" id="addInstrumentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus-circle"></i> Agregar Nuevo Instrumento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <!-- Selección de categoría -->
                    <div class="input-group mb-3">
                        <label for="categoriaInstrumento">Categoría:</label>
                        <select id="categoriaInstrumento" class="form-select" onchange="cambiarCategoria()">
                            <option value="">Seleccione una categoría</option>
                            <option value="computadora">Computadora</option>
                            <option value="monitor">Monitor</option>
                            <option value="periferico">Periférico</option>
                        </select>
                    </div>

                    <!-- Código (siempre visible) -->
                    <div class="input-group mb-3">
                        <label for="newCodigo">Código de Barras (Escaneado):</label>
                        <input type="text" id="newCodigo" class="form-control" readonly />
                    </div>

                    <!-- COMPUTADORA -->
                    <div id="form-computadora" class="categoria-form hidden">
                        <h6 class="mt-3 mb-3">Especificaciones de Computadora</h6>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <label for="pcTipo">Tipo:</label>
                                <select id="pcTipo" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="all-in-one">All-in-One</option>
                                    <option value="laptop">Laptop</option>
                                    <option value="desktop">Computador de Escritorio</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="pcMarca">Marca:</label>
                                <select id="pcMarca" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="dell">Dell</option>
                                    <option value="hp">HP</option>
                                    <option value="lenovo">Lenovo</option>
                                    <option value="acer">Acer</option>
                                    <option value="asus">ASUS</option>
                                    <option value="apple">Apple</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="pcRAM">Memoria RAM:</label>
                                <select id="pcRAM" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="4 GB">4 GB</option>
                                    <option value="8 GB">8 GB</option>
                                    <option value="16 GB">16 GB</option>
                                    <option value="32 GB">32 GB</option>
                                    <option value="64 GB">64 GB</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="pcAlmacenamientoTipo">Tipo Almacenamiento:</label>
                                <select id="pcAlmacenamientoTipo" class="form-select" onchange="toggleAlmacenamientoDual()">
                                    <option value="">Seleccione</option>
                                    <option value="SSD">SSD</option>
                                    <option value="HDD">HDD</option>
                                    <option value="SSD+HDD">SSD + HDD</option>
                                </select>
                            </div>
                            <!-- SSD -->
                            <div id="pcSSDGroup" class="col-md-6 hidden">
                                <label for="pcSSDCap">Capacidad SSD:</label>
                                <select id="pcSSDCap" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="128 GB">128 GB</option>
                                    <option value="256 GB">256 GB</option>
                                    <option value="512 GB">512 GB</option>
                                    <option value="1 TB">1 TB</option>
                                    <option value="2 TB">2 TB</option>
                                </select>
                            </div>
                            <!-- HDD -->
                            <div id="pcHDDGroup" class="col-md-6 hidden">
                                <label for="pcHDDCap">Capacidad HDD:</label>
                                <select id="pcHDDCap" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="500 GB">500 GB</option>
                                    <option value="1 TB">1 TB</option>
                                    <option value="2 TB">2 TB</option>
                                    <option value="3 TB">3 TB</option>
                                    <option value="4 TB">4 TB</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="pcProcesadorMarca">Marca Procesador:</label>
                                <select id="pcProcesadorMarca" class="form-select" onchange="actualizarModelosProcesador()">
                                    <option value="">Seleccione</option>
                                    <option value="intel">Intel</option>
                                    <option value="amd">AMD</option>
                                    <option value="apple">Apple (M1/M2)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="pcProcesadorModelo">Modelo:</label>
                                <select id="pcProcesadorModelo" class="form-select">
                                    <option value="">Seleccione marca primero</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="pcSO">Sistema Operativo:</label>
                                <select id="pcSO" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="Windows 10">Windows 10</option>
                                    <option value="Windows 11">Windows 11</option>
                                    <option value="Linux">Linux</option>
                                    <option value="macOS">macOS</option>
                                    <option value="Sin sistema">Sin sistema</option>
                                </select>
                            </div>
                            <!-- ✅ Estado general para computadora -->
                            <div class="col-md-6">
                                <label for="pcEstado">Estado del Equipo:</label>
                                <select id="pcEstado" class="form-select">
                                    <option value="bueno">Bueno</option>
                                    <option value="regular">Regular</option>
                                    <option value="malo">Malo</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- MONITOR -->
                    <div id="form-monitor" class="categoria-form hidden">
                        <h6 class="mt-3 mb-3">Especificaciones de Monitor</h6>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <label for="monitorMarca">Marca:</label>
                                <select id="monitorMarca" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="dell">Dell</option>
                                    <option value="hp">HP</option>
                                    <option value="lenovo">Lenovo</option>
                                    <option value="samsung">Samsung</option>
                                    <option value="lg">LG</option>
                                    <option value="acer">Acer</option>
                                    <option value="asus">ASUS</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="monitorPulgadas">Pulgadas:</label>
                                <select id="monitorPulgadas" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="19">19"</option>
                                    <option value="22">22"</option>
                                    <option value="24">24"</option>
                                    <option value="27">27"</option>
                                    <option value="32">32"</option>
                                    <option value="34">34" (UltraWide)</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label>Entradas disponibles:</label>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="entradaHDMI" value="HDMI">
                                            <label class="form-check-label" for="entradaHDMI">HDMI</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="entradaVGA" value="VGA">
                                            <label class="form-check-label" for="entradaVGA">VGA</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="entradaDP" value="DisplayPort">
                                            <label class="form-check-label" for="entradaDP">DisplayPort</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="entradaUSBC" value="USB-C">
                                            <label class="form-check-label" for="entradaUSBC">USB-C</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- ✅ Estado para monitor -->
                            <div class="col-md-6">
                                <label for="monitorEstado">Estado del Monitor:</label>
                                <select id="monitorEstado" class="form-select">
                                    <option value="bueno">Bueno</option>
                                    <option value="regular">Regular</option>
                                    <option value="malo">Malo</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- PERIFÉRICO -->
                    <div id="form-periferico" class="categoria-form hidden">
                        <h6 class="mt-3 mb-3">Especificaciones de Periférico</h6>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <label for="perifericoTipo">Tipo:</label>
                                <select id="perifericoTipo" class="form-select" onchange="cambiarTipoPeriferico()">
                                    <option value="">Seleccione</option>
                                    <option value="mouse">Mouse</option>
                                    <option value="teclado">Teclado</option>
                                    <option value="audifonos">Audífonos</option>
                                    <option value="parlantes">Parlantes</option>
                                    <option value="webcam">Webcam</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="perifericoMarca">Marca:</label>
                                <select id="perifericoMarca" class="form-select">
                                    <option value="">Seleccione tipo primero</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="perifericoConectividad">Conectividad:</label>
                                <select id="perifericoConectividad" class="form-select">
                                    <option value="">Seleccione</option>
                                    <option value="alámbrico">Alámbrico</option>
                                    <option value="inalámbrico">Inalámbrico (2.4 GHz)</option>
                                    <option value="bluetooth">Bluetooth</option>
                                    <option value="usb">USB (plug & play)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="perifericoEstado">Estado:</label>
                                <select id="perifericoEstado" class="form-select">
                                    <option value="bueno">Bueno</option>
                                    <option value="regular">Regular</option>
                                    <option value="malo">Malo</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="guardarNuevoInstrumento()">Guardar Instrumento</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Script principal -->
    <script src="static/js/script.js"></script>
</body>
</html>